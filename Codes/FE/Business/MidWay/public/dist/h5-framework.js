if(function(e){var s={readyFuncs:[],destroyFuncs:[],flipFuncs:[]},r=function(){},o=navigator.userAgent;function t(e,n,t){var i=s[e];if(!0===n)for(var o=i,a=o.length;a--;)try{o[a]()}catch(e){console.error(e)}else"function"==typeof n&&i.push(Utils.bind(t,n)||r)}e.Utils={pluginConfig:{},getPlatform:function(){for(var e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n="pc",t=0,i=e.length;t<i;t++)if(0<o.indexOf(e[t])){n="mobile";break}return n},isWX:function(){return!(!/(micromessenger)\/([\w\.]+)/i.test(o)||/miniprogram/i.test(o))},isMiniprogram:function(){if(/(micromessenger)\/([\w\.]+)/i.test(o)&&/miniprogram/i.test(o))return!0},checkCssAnimation:function(){for(var e=document.createElement("div").style,n=["animation","webkitAnimation","msAnimation","MozAnimation","-moz-animation","-webkit-animation"],t=0,i=n.length;t<i;t++)if(n[t]in e)return!0;return!1},getQueryString:function(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),t=location.search.substr(1).match(n);if(null!=t){var i=t[2];try{i=decodeURIComponent(i)}catch(e){i=unescape(i)}return i}return null},getViewport:function(){var e=window.innerHeight,n=window.innerWidth;return isNaN(e)&&("CSS1Compat"==document.compatMode?(n=document.documentElement.clientWidth,e=document.documentElement.clientHeight):(n=document.body.clientWidth,e=document.body.clientHeight)),{height:e,width:n}},getToken:function(e){if(s.token)return e&&e(s.token);var n=Utils.getQueryString("session_id"),t=/^[a-f0-9]{8}(-[a-f0-9]{4}){3}-[a-f0-9]{12}$/i;if(Utils.isWX()&&(!n||!t.test(n))){console.log("调用微信授权获取用户信息");var i="api-kpaas.cloudmarkee.com";return/^(http[s]?:\/\/[w]{0,3}\.?)?[0-9]*\.(pc|wap)/i.test(location.href)&&(i="api.kpaas.biaoxiaoxu.cn"),void(location.href="http://"+i+"/api/identify_service/v1/openauth/wx_authorize?secret_key=e00a05cf37305a22ba10fec428b4ab01&redirect_uri="+encodeURIComponent(location.href))}t.lastIndex=0;var o=window.extend||$.extend,a=o(!0,{userId:"00000000-0000-0000-0000-000000010001",phoneNumber:"18900010001",nickName:"kma mock user",id:"",session_id:""},n&&t.test(n)?{userId:Utils.getQueryString("userId"),phoneNumber:Utils.getQueryString("phoneNumber"),nickName:Utils.getQueryString("nickName"),id:Utils.getQueryString("id"),session_id:n}:{});return s.token=o(!0,{},a),e&&e(a)},getShareId:function(){return this.shareId},createScript:function(e,n){if(e){var t=$("<script/>");t.one("load",n||r),t.attr("src",e),$("body").append(t)}},bind:function(n,t){return t.bind?t.bind(n):function(){var e=[].slice.call(arguments);return t.apply(n,e)}},ready:function(e,n){t("readyFuncs",e,n)},destroy:function(e,n){t("destroyFuncs",e,n)},flip:function(e,n){t("flipFuncs",e,n)},on:function(e,n){PubSub.subscribe(e,n)},off:function(e){PubSub.unsubscribe(e)},emit:function(e,n){PubSub.publish(e,n)},getTemplate:function(e,n){var t=new RegExp('<script\\s+id="'+n+'"[^>]*?>[\\s\\S]*?<\\/script>',"gi");return e.match(t)[0].replace(/<script[^>]*?>/,"").replace(/<\/script>/gi,"")},simpleMsg:function(e,n){e||n(!1);var t=$("#msg-model");t.find("span").html(e),t.show(),this.bindAnim(t,"bounceInDown"),this.$setTimeout=setTimeout(function(){t.hide(),clearTimeout(this.$setTimeout)},2e3),n&&n(!1)},formValidation:function(e,n){for(var t=0,i=e.length,o=/^(13[0-9]|15[0-9]|17[0-9]|18[0-9]|14[57])[0-9]{8}$/,a=/^\d+$/i,s=/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/,r=/(^\d{15}$)|(^\d{17}([0-9]|X)$)/i;t<i;t++){var c=e[t].type?e[t].type:"",l=e[t].value?e[t].value:"",u=e[t].reg?e[t].reg:"",d=e[t].minLength?e[t].minLength:"",m=e[t].maxLength?e[t].maxLength:"",p="number"==typeof e[t].maxValue?e[t].maxValue:"",g=e[t].maxValueErr?e[t].maxValueErr:"",f=e[t].emptyErr?e[t].emptyErr:"",h=e[t].regErr?e[t].regErr:"",y=e[t].lengthErr?e[t].lengthErr:"";if(c)switch(c){case"phone":u=o;break;case"number":u=a;break;case"email":u=s;break;case"identitycard":u=r}if(""==l||null==l)return void this.simpleMsg(f,n);if(u&&!u.test(l))return void this.simpleMsg(h,n);if(m&&l.length>m||d&&l.length<d)return void this.simpleMsg(y,n);if("number"==typeof e[t].maxValue&&p<l)return void this.simpleMsg(g,n)}n(!0)},bindAnim:function(e,n,t){$(e).addClass(n+" animated").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass(n+" animated"),t&&t()})},postMessage:function(e,n){$("#"+e).find(".frame-container")[0].contentWindow.postMessage({controlId:e,relationId:lanh.kid,type:n},"*")},openActivityReadme:function(a,e){var s=this,t=Utils.pluginConfig[a].theme.theme||"default";Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(s.getTemplate(e,"activity-readme"))})}),new Promise(function(n,e){Utils.getToken(function(e){$.ajax({url:lanh.apiHost+"activity/plugin/prize?relationId="+lanh.kid+"&controlId="+a,type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},success:function(e){n(e.data)},error:function(e){400==e.status?Utils.simpleMsg(JSON.parse(e.responseText).message||"获取数据失败!"):Utils.simpleMsg("获取数据失败!")}})})})]).then(function(e){var n=e[1].prizes.map(function(e,n){return'<p class="text-left medium-font">'+e.optionName+"："+e.prizeName+"</p>"}).join(""),t='<p class="text-left medium-font">'+Utils.pluginConfig[a].actStartTime+" - "+Utils.pluginConfig[a].actEndTime+"</p>",i=Utils.pluginConfig[a].controlData.rule?'<p class="readme-tag tag-bg medium-font">活动规则</p><div class="cont-row"><p class="text-left medium-font" style="word-break: break-all;">'+Utils.pluginConfig[a].controlData.rule+"</p></div>":"",o=e[0].replace("${myPrize}",n).replace("${activityTime}",t).replace("${rule}",i);layer.open({type:0,anim:!1,title:['<img style="width: auto;height: 1rem; vertical-align: middle;" src="/public/images/h5/activity-readme.png"/>',"height: 1.28rem;line-height: 1.28rem; background-color: rgba(0, 204, 153, 0.3); color:#fff; background-image: url('/public/images/h5/activity-readme-bg.png');background-size:100% 100%;"],content:o,className:"layer-activity-readme",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,success:function(e){var n=$(e).find("#close-btn"),t="pc"==s.getPlatform()?"click":"touchend";s.bindAnim($(".layer-activity-readme"),"bounceInDown"),n.on(t,function(){s.bindAnim($(".layer-activity-readme"),"bounceOutUp",function(){layer.closeAll()})})}})}).catch(function(){})},openQrcode:function(t,e){var i=this,o=Utils.pluginConfig[t].theme.theme||"default";new Promise(function(n,e){$.get("/public/layer/theme/"+o+"/tpl.html",function(e){n(i.getTemplate(e,"qrcode"))})}).then(function(e){var n=e.replace("${qrcode}",Utils.pluginConfig[t].controlData.qrcode.url);layer.open({type:0,anim:!1,content:n,className:"layer-qrcode",shade:"background-color: rgba(0,0,0,.6)",success:function(e){i.bindAnim($(".layer-qrcode"),"bounceInDown")}})}).catch(function(){})},openWinningForm:function(a,s){var r=this,t=Utils.pluginConfig[a].theme.theme||"default",c=Utils.pluginConfig[a].controlData.fromSetting;Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(r.getTemplate(e,"winning-form"))})}),new Promise(function(e,n){e(0)})]).then(function(e){var n=e[0].replace("${prize}",s.prize).replace("${formContent}",c.map(function(e,n){return'<p><label class="small-font">'+e.name+'：</label><input id="'+e.id+'" type="text"/></p>'}).join(""));layer.open({type:0,anim:!1,content:n,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,success:function(o){var e=$(o).find("#goBack"),n=$(o).find("#submit"),t="pc"==r.getPlatform()?"click":"touchend";$(o).parents(".frame-container");r.bindAnim($(".layer-winning"),"bounceInDown"),e.on(t,function(){layer.closeAll(),r.postMessage(a,"game_reset")}),n.on(t,function(){var i=[];$.each(c,function(e,n){var t={type:n.category,value:$(o).find("#"+n.id).val(),emptyErr:"请填写"+n.name,regErr:"请输入正确的"+n.name};"name"==n.category?(t.maxLength=20,t.lengthErr=n.name+"不能超过20个字符",t.isName=!0):"phone"==n.category?t.isPhone=!0:(t.maxLength=100,t.lengthErr=n.name+"不能超过100个字符"),i.push(t)}),r.formValidation(i,function(e){if(!e)return!1;$.each(c,function(e,n){n.type=n.type+"_"+n.category,n.content=$(o).find("#"+n.id).val(),delete n.id,delete n.value}),Utils.getToken(function(e){$.ajax({url:lanh.apiHost+"activity/plugin/from/content",type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:JSON.stringify({relationId:lanh.kid,controlId:a,contents:c,shareId:Utils.getQueryString("as_belong_user")||""}),success:function(e){r.openWinningInfo(a,{prize:s.prize,formArr:c})},error:function(e){400==e.status?Utils.simpleMsg(JSON.parse(e.responseText).message||"提交失败!"):Utils.simpleMsg("提交失败!")}})})})})}})}).catch(function(){})},openWinningInfo:function(o,i){var a=this,t=Utils.pluginConfig[o].theme.theme||"default";new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(a.getTemplate(e,"winning-info"))})}).then(function(e){var n=Utils.pluginConfig[o].controlData.qrcode.url?'<div class="winning-btn-wrap" style="margin-top:0.65rem;"><button id="goBack" class="winning-btn medium-font" style="margin-right: 0.5rem;">返回首页</button><button id="focus" class="winning-btn medium-font">关注我们</button></div>':'<div class="winning-btn-wrap" style="margin-top:0.65rem;"><button id="goBack" class="winning-btn medium-font">返回首页</button></div>',t=e.replace("${prize}",i.prize).replace("${formContent}",i.formArr.map(function(e,n){return'<p><label class="small-font">'+e.name+'：</label><span class="small-font">'+e.content+"</span></p>"}).join("")).replace("${focus}",n);layer.open({type:0,anim:!1,content:t,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!n,success:function(e){var n=$(e).find("#focus"),t=$(e).find("#goBack"),i="pc"==a.getPlatform()?"click":"touchend";a.bindAnim($(".layer-winning"),"bounceInDown"),n.on(i,function(){a.openQrcode(o)}),t.on(i,function(){layer.closeAll(),a.postMessage(o,"game_reset")})}})}).catch(function(){})},openNotWinning:function(o,e){var a=this,t=Utils.pluginConfig[o].theme.theme||"default";new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(a.getTemplate(e,"not-winning"))})}).then(function(e){var n=Utils.pluginConfig[o].controlData.qrcode.url?'<button id="goBack" class="winning-btn medium-font" style="margin-right: 0.5rem;">再来一次</button><button id="focus" class="winning-btn medium-font">关注我们</button>':'<button id="goBack" class="winning-btn medium-font">再来一次</button>',t=e.replace("${focus}",n);layer.open({type:0,anim:!1,content:t,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,success:function(e){var n=$(e).find("#goBack"),t=$(e).find("#focus"),i="pc"==a.getPlatform()?"click":"touchend";a.bindAnim($(".layer-winning"),"bounceInDown"),n.on(i,function(){layer.closeAll(),a.postMessage(o,"game_restart")}),t.on(i,function(){a.openQrcode(o)})}})})},openNoWinningInfo:function(o,i){var a=this,t=Utils.pluginConfig[o].theme.theme||"default";new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(a.getTemplate(e,"no-winning-info"))})}).then(function(e){var n=Utils.pluginConfig[o].controlData.qrcode.url?'<button id="goBack" class="winning-btn medium-font" style="margin-right: 0.5rem;">返回首页</button><button id="focus" class="winning-btn medium-font">关注我们</button>':'<button id="goBack" class="winning-btn medium-font">返回首页</button>',t=e.replace("${focus}",n).replace("${face}",i.face);layer.open({type:0,anim:!1,content:t,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,success:function(e){var n=$(e).find("#goBack"),t=$(e).find("#focus"),i="pc"==a.getPlatform()?"click":"touchend";a.bindAnim($(".layer-winning"),"bounceInDown"),n.on(i,function(){layer.closeAll(),a.postMessage(o,"game_reset")}),t.on(i,function(){a.openQrcode(o)})}})})},openMyPrize:function(t){var n=this;new Promise(function(n,e){Utils.getToken(function(e){$.ajax({url:lanh.apiHost+"activity/plugin/drawprize/log?relationId="+lanh.kid+"&controlId="+t,type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},success:function(e){n(e.data)},error:function(e){400==e.status?Utils.simpleMsg(JSON.parse(e.responseText).message||"获取数据失败!"):Utils.simpleMsg("获取数据失败!")}})})}).then(function(e){e.log?e.content?n.openWinningInfo(t,{prize:e.log.prizeName,formArr:e.content}):n.openWinningForm(t,{prize:e.log.prizeName}):n.openNoWinningInfo(t,{face:e.face||"/public/images/h5/default-face.png"})})},smashGoldEgg:function(t){var i=this,o=Utils.pluginConfig[t].theme.theme||"default";Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+o+"/smash-gold-eggs.html",function(e){n(i.getTemplate(e,"smashGoldEgg"))})})]).then(function(e){layer.open({type:0,anim:!1,content:e[0],shadeClose:!1,className:"layer-smashGoldEggs",shade:"background-color: rgba(0,0,0,.6)",success:function(n){var e="pc"==i.getPlatform()?"click":"touchend";$(n).find(".closeBtn").on(e,function(e){layer.closeAll()}),$(n).find(".hammer").on(e,function(e){i.goDrawPrize(t,function(e){$(n).find(".smashGoldEgg-bg").addClass("smashing"),setTimeout(function(){$(n).find(".smashGoldEgg-bg").removeClass("smashing"),$(n).find(".smashGoldEgg-bg").addClass("smashed"),setTimeout(function(){$(n).find(".smashGoldEgg-bg").addClass("finished"),i.emit("draw_end",{controlId:t,data:e})},800)},800)})})}})})},dismantRedEnvekopes:function(t){var i=this,o=Utils.pluginConfig[t].theme.theme||"default";Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+o+"/dismant-red-envelopes.html",function(e){n(i.getTemplate(e,"dismantRedEnvelopes"))})})]).then(function(e){layer.open({type:0,anim:!1,content:e[0],className:"layer-dismantRedEnvelopes",shadeClose:!1,shade:"background-color: rgba(0,0,0,.6)",success:function(e){var n="pc"==i.getPlatform()?"click":"touchend";$(e).find(".redEnvelopes").on(n,function(e){var n=this;i.goDrawPrize(t,function(e){$(n).attr("src","/public/images/dismant-red-envelopes/redEnvelopes2.png"),i._setTimeout&&clearTimeout(i._setTimeout),i._setTimeout=setTimeout(function(){i.emit("draw_end",{controlId:t,data:e})},1e3)})}),$(e).find(".closeBtn").on(n,function(e){layer.closeAll()})}})})},drawAnimation:function(o,e){var a=this,t=Utils.pluginConfig[o].theme.theme||"default";new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/draw.html",function(e){n(a.getTemplate(e,"draw"))})}).then(function(e){layer.open({type:0,anim:!1,content:e,className:"layer-draw",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,success:function(e){var n=$(e).find("#start"),t=$(e).find(".closeBtn"),i="pc"==a.getPlatform()?"click":"touchend";a.bindAnim($(".draw"),"bounceInDown"),n.on(i,function(){n.parent().addClass("start"),a.goDrawPrize(o,function(e){a._setTimeout&&clearTimeout(a._setTimeout),a._setTimeout=setTimeout(function(){a.emit("draw_end",{controlId:o,data:e})},1e3)})}),t.on(i,function(){a.bindAnim($(".draw"),"bounceOutUp",function(){layer.closeAll()})})}})})},openGameRank:function(t,i){var o=this,a=Utils.pluginConfig[t].theme.theme||"default",s="",r="";Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+a+"/game-ranks.html",function(e){s=o.getTemplate(e,"rank1"),r=o.getTemplate(e,"rank2"),n(o.getTemplate(e,"gameRankings"))})}),new Promise(function(n,e){Utils.getToken(function(e){$.ajax({url:lanh.apiHost+"activity/plugin/score/list",type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:{relationId:lanh.kid,controlId:t,pageIndex:1,pageSize:100},success:function(e){n(e.data)},error:function(e){400==e.status?Utils.simpleMsg(JSON.parse(e.responseText).message||"获取数据失败!"):Utils.simpleMsg("获取数据失败!")}})})})]).then(function(e){var t="";0<e[1].list.length?e[1].list.forEach(function(e,n){t+=n<3?s.replace("{imgRank}",0==n?"first":1==n?"second":"third").replace("{faceImg}",e.userFace).replace("{nickName}",e.userNickname).replace("{score}",e.score):r.replace("{rank}",n+1).replace("{faceImg}",e.userFace).replace("{nickName}",e.userNickname).replace("{score}",e.score)}):t="<tr><td colspan='4'>暂无排名</td></tr>";var n=e[0].replace("{myselfRank}",e[1].rank).replace("{myselfFace}",e[1].userFace).replace("{rankContent}",t);layer.open({type:0,anim:!1,content:n,shadeClose:!1,className:"layer-gameRankings",shade:"background-color: rgba(0,0,0,.6)",success:function(e){var n="pc"==o.getPlatform()?"click":"touchend";$(e).find(".closeBtn").on(n,function(e){i?(o.bindAnim($(".layer-gameRankings"),"fadeOut"),i()):layer.closeAll()})}})}).catch(function(){})},goDrawPrize:function(n,t){Utils.getToken(function(e){$.ajax({url:lanh.apiHost+"activity/plugin/drawprize",type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:JSON.stringify({relationId:lanh.kid,controlId:n}),success:function(e){t&&t(e.data)},error:function(e){400==e.status&&Utils.simpleMsg(JSON.parse(e.responseText).message)}})})},openchanllengeResult:function(r,c){var t,l=r.controlId,i=r.data.gameScore,o="",n="",u=this;t=Utils.pluginConfig[l].theme.theme||"default",o=i>=Utils.pluginConfig[l].score?"challenge-suc":"challenge-fail",new Promise(function(n,e){Utils.getToken(function(e){$.ajax({url:lanh.apiHost+"activity/plugin/score",type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:JSON.stringify({relationId:lanh.kid,controlId:r.controlId,score:i}),success:function(e){n(!0)},error:function(e){400==e.status&&Utils.simpleMsg(JSON.parse(e.responseText).message)}})})}).then(function(e){Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(u.getTemplate(e,o))})}),new Promise(function(n,e){Utils.getToken(function(e){$.ajax({url:lanh.apiHost+"activity/plugin/user/rank?relationId="+lanh.kid+"&controlId="+l,type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},success:function(e){n(e.data)},error:function(e){400==e.status?Utils.simpleMsg(JSON.parse(e.responseText).message||"获取数据失败!"):Utils.simpleMsg("获取数据失败!")}})})})]).then(function(e){switch(o){case"challenge-suc":n=e[0].replace("${score}",i).replace("${bitNum}",e[1].rankPer).replace("${bestScores}",e[1].bestScore).replace("${bestRank}",e[1].bestRank).replace("${leftNum}",e[1].isWin?"":'<p class="small-font" style="top:9.7rem;color:#0ca3b0;">今日还有'+e[1].intervalDrawTime+"次抽奖机会</p>").replace("${bigBtn}",e[1].isWin?'<button id="my-prize" class="big-font">查看奖品</button>':0<e[1].intervalDrawTime?'<button id="goDraw" class="big-font">赶紧去抽奖</button>':'<button class="big-font disabeld">赶紧去抽奖</button>');break;case"challenge-fail":n=e[0].replace("${score}",i).replace("${needScore}",Utils.pluginConfig[l].score).replace("${bestScores}",e[1].bestScore).replace("${bestRank}",e[1].bestRank)}layer.open({type:0,anim:!1,content:n,className:"layer-draw",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,success:function(e){var n=$(e).find("#rank"),t=$(e).find("#restart"),i=$(e).find("#goBack"),o=$(e).find("#my-prize"),a=$(e).find("#goDraw"),s="pc"==u.getPlatform()?"click":"touchend";c||u.bindAnim($(".challenge-suc-bg"),"bounceInDown"),t.on(s,function(){layer.closeAll(),u.postMessage(l,"game_restart")}),i.on(s,function(){layer.closeAll(),u.postMessage(l,"game_reset")}),o.on(s,function(){u.openMyPrize(l)}),a.on(s,function(){switch(layer.closeAll(),Utils.pluginConfig[l].controlData.drawStyle){case"redEnvelope":u.dismantRedEnvekopes(l);break;case"golden":u.smashGoldEgg(l);break;case"draw":u.drawAnimation(l)}}),n.on(s,function(){u.openGameRank(l,function(){u.openchanllengeResult(r,!0)})})}})})}).catch(function(){})}},Utils.layerIndex=layer.open({type:2})}(window||this),"pc"==Utils.getPlatform()){var _layer=document.querySelector(".layui-m-layer"),_body=document.querySelector("body");window.addEventListener("focusin",function(){var e=e||window.event,n=e.target;_layer.style.top=-n.offsetTop+_body.scrollTop+n.clientHeight+"px"}),window.addEventListener("focusout",function(){_layer.style.top="0px"})}window.addEventListener("message",function(e){var n=e.data;return n&&"string"==typeof e.data&&JSON.parse(n),"flip"===n.type?Utils.emit("flip",n.pageIndex):Utils.emit(n.type,n)},!1),Utils.on("game_init",function(e,n){console.log(t);var t=n.data||{},i=n.contentWindow;t.type="game_init",i&&i.postMessage(t,"*")}),Utils.on("draw_prize",function(e,n){Utils.openchanllengeResult(n)}),Utils.on("draw_end",function(e,n){switch(n.data.code){case 1:case 4:case 8:Utils.openNotWinning(n.controlId);break;case 5:Utils.simpleMsg("您今天的抽奖次数已用完，下次好运。");break;case 6:Utils.simpleMsg("您已经领取过奖品，点击我的奖品查看。");break;case 10:Utils.simpleMsg("活动未开始或已结束，请注意查看说明。");break;case 200:Utils.openWinningForm(n.controlId,{prize:n.data.prizeName});break;default:Utils.simpleMsg("服务端发生异常，小宝正火速解决。")}}),Utils.on("my_prize",function(e,n){Utils.openMyPrize(n.controlId)}),Utils.on("game_info",function(e,n){Utils.openActivityReadme(n.controlId)}),Utils.on("game_rank",function(e,n){Utils.openGameRank(n.controlId)}),$(function(){if(!Utils.checkCssAnimation())return Utils.createScript("/public/dist/qrcode.min.js",function(){$("#page-qrcode").show(),new QRCode(document.getElementById("qrcode-panel"),{text:location.href,width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}),layer.close(Utils.layerIndex)});if(Utils.isWX()){location.href;Utils.getQueryString("session_id")?console.log("已经授权"):Utils.getToken(function(e){console.log(e)})}else Utils.isMiniprogram()&&Utils.createScript("https://res.wx.qq.com/open/js/jweixin-1.3.2.js");return function(){var n=!1;if($("#page-panel").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){function e(e,n){var t=$.extend(!0,{type:"pagination"},n);parent&&parent.postMessage(t,"*")}n||(n=!0,Utils.on("pageinit",e),Utils.on("pagechanged",e),Utils.ready(!0),layer.close(Utils.layerIndex))}).show(),setTimeout(function(){$("#page-panel").addClass("animated fadeIn"),$("#layui-m-layer"+Utils.layerIndex).addClass("animated fadeOut")},100),"pc"!==Utils.getPlatform()||document.referrer){var e=Utils.getViewport();$("#page-panel").css({height:e.height,width:e.width})}else $("html").css({"background-color":"rgb(137, 150, 160)"});var t=$("#fastNav");"pc"==Utils.getPlatform()&&t.hide();var i="pc"==Utils.getPlatform()?"click":"touchend";t.find(".btn-isOpen").on(i,function(e){"0rem"==t.find(".btn-nav").css("margin-right")?(t.find(".btn-nav").css({"margin-right":"-2.8rem"}),$(this).css({" background-image":"url(/public/images/open.png)"})):(t.find(".btn-nav").css({"margin-right":"0rem"}),$(this).css({" background-image":"url(/public/images/takeup.png)"}))}),t.find(".btn-index").on(i,function(e){wx.miniProgram.reLaunch({url:"/pages/home/home"}),e.stopPropagation()}),t.find(".btn-my").on(i,function(e){wx.miniProgram.reLaunch({url:"/pages/my/index"}),e.stopPropagation()})}()});