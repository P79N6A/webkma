if(function(e){var s={readyFuncs:[],destroyFuncs:[],flipFuncs:[]},r=function(){},a=navigator.userAgent;function t(e,n,t){var i=s[e];if(!0===n)for(var a=i,o=a.length;o--;)try{a[o]()}catch(e){console.error(e)}else"function"==typeof n&&i.push(Utils.bind(t,n)||r)}e.Utils={pluginConfig:{},apiConfig:"",secret_key:"e00a05cf37305a22ba10fec428b4ab01",shopHost:"https://kshoptest-wap.tuixb.cn/",getPlatform:function(){for(var e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n="pc",t=0,i=e.length;t<i;t++)if(0<a.indexOf(e[t])){n="mobile";break}return n},isWX:function(){return!(!/(micromessenger)\/([\w\.]+)/i.test(a)||/miniprogram/i.test(a))},isMiniprogram:function(){if(/(micromessenger)\/([\w\.]+)/i.test(a)&&/miniprogram/i.test(a))return!0},isWxMini:function(n){"micromessenger"==a.toLowerCase().match(/MicroMessenger/i)?wx.miniProgram.getEnv(function(e){e.miniprogram?n&&n(!0):n&&n(!1)}):n&&n(!1)},isSupport:function(){var e={},n=navigator.userAgent.toLowerCase(),t=!0;function i(e){for(var n=(e=e.toString()).split("."),t=["","0","00","000","0000"].reverse(),i=0;i<n.length;i++){var a=n[i].length;n[i]=t[a]+n[i]}return n.join("")}try{e.name=-[1]?0<n.indexOf("firefox")?"firefox":0<n.indexOf("chrome")?"chrome":window.opera?"opera":window.openDatabase?"safari":"unkonw":"ie"}catch(e){}"safari"==e.name&&"pc"==this.getPlatform()&&(i(a.match(/Version\/(\d+(.\d+)*)/)[1])<=i("6.2.8")&&(t=!1,layer.open({content:"您当前的Safari浏览器版本暂不支持访问该游戏",style:"width: 8rem",btn:"我知道了"})));return t},checkCssAnimation:function(){for(var e=document.createElement("div").style,n=["animation","webkitAnimation","msAnimation","MozAnimation","-moz-animation","-webkit-animation"],t=0,i=n.length;t<i;t++)if(n[t]in e)return!0;return!1},getQueryString:function(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),t=location.search.substr(1).match(n);if(null!=t){var i=t[2];try{i=decodeURIComponent(i)}catch(e){i=unescape(i)}return i}return null},getViewport:function(){var e=window.innerHeight,n=window.innerWidth;return isNaN(e)&&("CSS1Compat"==document.compatMode?(n=document.documentElement.clientWidth,e=document.documentElement.clientHeight):(n=document.body.clientWidth,e=document.body.clientHeight)),{height:e,width:n}},getToken:function(e){var n=Utils.getQueryString("session_id")||sessionStorage.getItem("session_id")||"",t=/^[a-f0-9]{8}(-[a-f0-9]{4}){3}-[a-f0-9]{12}$/i;t.lastIndex=0;var i=window.extend||$.extend,a=i(!0,{userId:"00000000-0000-0000-0000-000000010001",phoneNumber:"18900010001",nickName:"kma mock user",id:"",session_id:""},n&&t.test(n)?{userId:Utils.getQueryString("userId"),phoneNumber:Utils.getQueryString("phoneNumber"),nickName:Utils.getQueryString("nickName"),id:Utils.getQueryString("id"),session_id:n}:{});return s.token=i(!0,{},a),e&&e(a)},getShareId:function(){return this.shareId},createScript:function(e,n){if(e){var t=$("<script/>");t.one("load",n||r),t.attr("src",e),$("body").append(t)}},bind:function(n,t){return t.bind?t.bind(n):function(){var e=[].slice.call(arguments);return t.apply(n,e)}},ready:function(e,n){t("readyFuncs",e,n)},destroy:function(e,n){t("destroyFuncs",e,n)},flip:function(e,n){t("flipFuncs",e,n)},on:function(e,n){PubSub.subscribe(e,n)},off:function(e){PubSub.unsubscribe(e)},emit:function(e,n){PubSub.publish(e,n)},getTemplate:function(e,n){var t=new RegExp('<script\\s+id="'+n+'"[^>]*?>[\\s\\S]*?<\\/script>',"gi");return e.match(t)[0].replace(/<script[^>]*?>/,"").replace(/<\/script>/gi,"")},simpleMsg:function(e,n){!e&&n&&n(!1);var t=$("#msg-model");t.find("span").html(e),t.show(),this.bindAnim(t,"bounceInDown"),this.$setTimeout=setTimeout(function(){t.hide(),clearTimeout(this.$setTimeout)},2e3),n&&n(!1)},loading:function(e){e=e||"加载中";this.loadingBox=layer.open({type:2,shadeClose:!1,content:e})},confim:function(n){this.confimBox=layer.open({content:n.text,btn:n.btnArr,yes:function(e){n.cb1&&n.cb1()},no:function(){n.cb2&&n.cb2()}})},dateString:function(e){if(!e)return"";var n=new Date(e),t=n.getFullYear(),i=n.getMonth()+1,a=n.getDate();return 1<=i&&i<=9&&(i="0"+i),0<=a&&a<=9&&(a="0"+a),t+"-"+i+"-"+a+" "+n.toTimeString().split(" ")[0]},formValidation:function(e,n){for(var t=0,i=e.length,a=/^1[0-9]{10}$/,o=/^\d+$/i,s=/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/,r=/(^\d{15}$)|(^\d{17}([0-9]|X)$)/i;t<i;t++){var c=e[t].type?e[t].type:"",l=e[t].value?e[t].value:"",d=e[t].reg?e[t].reg:"",p=e[t].minLength?e[t].minLength:"",u=e[t].maxLength?e[t].maxLength:"",g="number"==typeof e[t].maxValue?e[t].maxValue:"",m=e[t].maxValueErr?e[t].maxValueErr:"",f=e[t].emptyErr?e[t].emptyErr:"",h=e[t].regErr?e[t].regErr:"",y=e[t].lengthErr?e[t].lengthErr:"";if(c)switch(c){case"phone":d=a;break;case"number":d=o;break;case"email":d=s;break;case"identitycard":d=r}if(""==l||null==l)return this.simpleMsg(f,n),!1;if(d&&!d.test(l))return this.simpleMsg(h,n),!1;if(u&&l.length>u||p&&l.length<p)return this.simpleMsg(y,n),!1;if("number"==typeof e[t].maxValue&&g<l)return this.simpleMsg(m,n),!1}n(!0)},bindAnim:function(e,n,t){$(e).addClass(n+" animated").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass(n+" animated"),t&&t()})},postMessage:function(e,n){$("#"+e).find(".frame-container")[0].contentWindow.postMessage({controlId:e,relationId:lanh.kid,type:n},"*")},openActivityReadme:function(o,e){var s=this,t=Utils.pluginConfig[o].theme.theme||"default";s.loading("获取活动说明内容，请稍后"),Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(s.getTemplate(e,"activity-readme"))})}),new Promise(function(n,t){Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"activity/plugin/prize?relationId="+lanh.kid+"&controlId="+o+"&session_id="+e.session_id,type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},success:function(e){e.data.prizes=e.data.prizes.sort(function(e,n){return e.sort-n.sort}),n(e.data)},error:function(e){400==e.status?Utils.simpleMsg(JSON.parse(e.responseText).message||"获取数据失败!"):Utils.simpleMsg("获取数据失败!"),t()}})})})]).then(function(e){layer.close(s.loadingBox);var n=e[1].prizes.map(function(e,n){return'<p class="text-left medium-font">'+e.optionName+"："+e.prizeName+"</p>"}).join(""),t='<p class="text-left medium-font">'+Utils.pluginConfig[o].actStartTime+" - "+Utils.pluginConfig[o].actEndTime+"</p>",i=Utils.pluginConfig[o].controlData.rule?'<p class="readme-tag tag-bg medium-font">活动规则</p><div class="cont-row"><p class="text-left medium-font" style="word-break: break-all;">'+Utils.pluginConfig[o].controlData.rule+"</p></div>":"",a=e[0].replace("${myPrize}",n).replace("${activityTime}",t).replace("${rule}",i);layer.open({type:0,anim:!1,title:['<img style="width: auto;height: 1rem; vertical-align: middle;" src="/public/images/h5/activity-readme.png"/>',"height: 1.28rem;line-height: 1.28rem; background-color: rgba(0, 204, 153, 0.3); color:#fff; background-image: url('/public/images/h5/activity-readme-bg.png');background-size:100% 100%;"],content:a,className:"layer-activity-readme",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,success:function(e){var n=$(e).find("#close-btn"),t="pc"==s.getPlatform()?"click":"touchend";s.bindAnim($(".layer-activity-readme"),"bounceInDown"),n.on(t,function(){s.bindAnim($(".layer-activity-readme"),"bounceOutUp",function(){layer.closeAll()})})}})}).catch(function(){layer.close(s.loadingBox)})},openQrcode:function(i,e){var a=this,t=Utils.pluginConfig[i].theme.theme||"default";new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(a.getTemplate(e,"qrcode"))})}).then(function(e){var n=e.replace("${qrcode}",Utils.pluginConfig[i].controlData.qrcode.url);layer.open({type:0,anim:!1,content:n,className:"layer-qrcode",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(e){var n=$(e).find("#goBack"),t="pc"==a.getPlatform()?"click":"touchend";a.bindAnim($(".layer-qrcode"),"bounceInDown"),n.on(t,function(){layer.closeAll(),a.postMessage(i,"game_reset")})}})}).catch(function(){})},openSwitchCashPrize:function(r,c){var l=this,t=Utils.pluginConfig[r].theme.theme||"default",d=Utils.pluginConfig[r].controlData;if(!d.newAttribute.onlineRewards||!d.newAttribute.offlineRewards)return d.newAttribute.onlineRewards?l.onlineCashPrize(r,c):l.offlineCashPrize(r,c),!1;new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(l.getTemplate(e,c.icon?"switch-cash-prize_hasprizeImg":"switch-cash-prize"))})}).then(function(e){var n=e.replace("${optionName}",c.optionName).replace("${prize}",c.prizeName).replace("${prizeImg}",c.icon?'<p style="height:2rem;"><img id="prizeImg" src="'+c.icon+'" style="width:2rem;height:2rem;"/></p>':"").replace("${formContent}",d.fromSetting.map(function(e,n){return'<p><label class="mediau-font">'+e.name+'：</label><input class="mediau-font" id="'+e.id+'" type="text" autocomplete="off"/></p>'}).join("")).replace("${offlineInfo}",d.newAttribute.offlineTextList.map(function(e,n){return'<p><label class="medium-font">'+e.title+'：</label><span class="medium-font">'+e.value+"</span></p>"}).join(""));layer.open({type:0,anim:!1,content:n,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(a){var e=$(a).find("#goBack"),n=$(a).find("#submit"),t=$(a).find(".type-switch"),i=$(a).find(".form-content"),o="online",s="pc"==l.getPlatform()?"click":"touchend";$(i.get(0)).show(),l.bindAnim($(".layer-winning"),"bounceInDown"),t.on(s,function(e){if(!$(this).attr("data-type"))return!1;o=$(this).attr("data-type"),i.hide(),t.find(".iconfont").removeClass("icon-radio-checkded"),$(this).find(".iconfont").addClass("icon-radio-checkded"),$(a).find("#form-content-"+$(this).attr("data-type")).show()}),e.on(s,function(){layer.closeAll(),l.postMessage(r,"game_reset")}),n.on(s,function(){switch(o){case"online":var i=[];$.each(d.fromSetting,function(e,n){var t={type:n.category,value:$(a).find("#"+n.id).val(),emptyErr:"请填写"+n.name,regErr:"请输入正确的"+n.name};"name"==n.category?(t.maxLength=20,t.lengthErr=n.name+"不能超过20个字符",t.isName=!0):"phone"==n.category?t.isPhone=!0:(t.maxLength=100,t.lengthErr=n.name+"不能超过100个字符"),i.push(t)}),l.formValidation(i,function(e){if(!e)return!1;var i=[];$.each(d.fromSetting,function(e,n){i.push({name:n.name,sort:n.sort,type:n.type+"_"+n.category,content:$(a).find("#"+n.id).val()})}),l.loading("正在提交表单信息，请稍后"),function t(){Utils.getToken(function(n){Utils.isWxMini(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"activity/plugin/from/content?session_id="+n.session_id,type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:n.session_id},data:JSON.stringify({relationId:lanh.kid,controlId:r,contents:i,shareId:Utils.getQueryString("as_belong_user")||"",isWeapp:e?"weapp":l.isWX()?"wx":"pc",forwardKey:Utils.myforwardKey,rootUserId:Utils.myrootUserId||Utils.getQueryString("rootUserId")||Utils.getQueryString("userId"),extType:"game"}),success:function(e){layer.close(l.loadingBox),1==e.data||200==e.data?l.openMyPrize(r):101==e.data?l.simpleMsg("手机号已被使用"):l.simpleMsg("操作失败，请重试。code:"+e.data)},error:function(e){layer.close(l.loadingBox),l.confim({text:"提交表单失败，重新提交？",btnArr:["重新提交","返回首页"],cb1:function(){t()},cb2:function(){layer.closeAll(),l.postMessage(r,"game_reset")}})}})})})}()});break;case"offline":l.loading("切换兑奖方式中，请稍后"),Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"activity/plugin/change/usercashtype/offline?session_id="+e.session_id,type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:JSON.stringify({id:c.id}),success:function(e){layer.close(l.loadingBox),200==e.data?l.offlineCashPrize(r,c):l.simpleMsg("操作失败，请重试。code:"+e.data)},error:function(e){layer.close(l.loadingBox),l.simpleMsg("兑奖方式切换失败")}})})}})}})}).catch(function(){})},onlineCashPrize:function(o,t){var s=this,i=Utils.pluginConfig[o].theme.theme||"default",r=Utils.pluginConfig[o].controlData;new Promise(function(n,e){$.get("/public/layer/theme/"+i+"/tpl.html",function(e){n(s.getTemplate(e,t.icon?"online-cash-prize_hasprizeImg":"online-cash-prize"))})}).then(function(e){var n=e.replace("${optionName}",t.optionName).replace("${prize}",t.prizeName).replace("${prizeImg}",t.icon?'<p style="height:2rem;"><img id="prizeImg" src="'+t.icon+'" style="width:2rem;height:2rem;"/></p>':"").replace("${formContent}",r.fromSetting.map(function(e,n){return'<p><label class="mediau-font">'+e.name+'：</label><input class="mediau-font" id="'+e.id+'" type="text" autocomplete="off"/></p>'}).join(""));layer.open({type:0,anim:!1,content:n,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(a){var e=$(a).find("#goBack"),n=$(a).find("#submit"),t="pc"==s.getPlatform()?"click":"touchend";s.bindAnim($(".layer-winning"),"bounceInDown"),e.on(t,function(){layer.closeAll(),s.postMessage(o,"game_reset")}),n.on(t,function(){var i=[];$.each(r.fromSetting,function(e,n){var t={type:n.category,value:$(a).find("#"+n.id).val(),emptyErr:"请填写"+n.name,regErr:"请输入正确的"+n.name};"name"==n.category?(t.maxLength=20,t.lengthErr=n.name+"不能超过20个字符",t.isName=!0):"phone"==n.category?t.isPhone=!0:(t.maxLength=100,t.lengthErr=n.name+"不能超过100个字符"),i.push(t)}),s.formValidation(i,function(e){if(!e)return!1;var i=[];$.each(r.fromSetting,function(e,n){i.push({name:n.name,sort:n.sort,type:n.type+"_"+n.category,content:$(a).find("#"+n.id).val()})}),s.loading("正在提交表单信息，请稍后"),function t(){Utils.getToken(function(n){Utils.isWxMini(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"activity/plugin/from/content?session_id="+n.session_id,type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:n.session_id},data:JSON.stringify({relationId:lanh.kid,controlId:o,contents:i,shareId:Utils.getQueryString("as_belong_user")||"",isWeapp:e?"weapp":s.isWX()?"wx":"pc",forwardKey:Utils.myforwardKey,rootUserId:Utils.myrootUserId||Utils.getQueryString("rootUserId")||Utils.getQueryString("userId"),extType:"game"}),success:function(e){layer.close(s.loadingBox),1==e.data||200==e.data?s.openMyPrize(o):101==e.data?s.simpleMsg("手机号已被使用"):s.simpleMsg("操作失败，请重试。code:"+e.data)},error:function(e){layer.close(s.loadingBox),s.confim({text:"提交表单失败，重新提交？",btnArr:["重新提交","返回首页"],cb1:function(){t()},cb2:function(){layer.closeAll(),s.postMessage(o,"game_reset")}})}})})})}()})})}})}).catch(function(){})},offlineCashPrize:function(a,i){var o=this,t=Utils.pluginConfig[a].theme.theme||"default",s=Utils.pluginConfig[a].controlData;o.loading("正在生成兑奖二维码，请稍后"),function e(){Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(o.getTemplate(e,i.icon?"offline-cash-prize_hasprizeImg":"offline-cash-prize"))})}),new Promise(function(n,t){Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"manuscript/wxqrcode/get?session_id="+e.session_id,type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:JSON.stringify({page:"pages/index/index",scene:"act=offineCashPrize&id="+i.id}),success:function(e){n(e.data.file)},error:function(e){e.status,Utils.simpleMsg("生成二维码失败!"),t()}})})})]).then(function(e){layer.close(o.loadingBox);var n=Utils.pluginConfig[a].controlData.qrcode.url?'<div class="winning-btn-wrap" style="margin-top:0rem;"><span id="goBack" class="winning-btn medium-font" style="margin-right: 0.5rem;">返回首页</span><span id="focus" class="winning-btn medium-font">关注我们</span></div>':'<div class="winning-btn-wrap" style="margin-top:0rem;"><span id="goBack" class="winning-btn medium-font">返回首页</span></div>',t=e[0].replace("${optionName}",i.optionName).replace("${prize}",i.prizeName).replace("${prizeImg}",i.icon?'<p style="height:2rem;"><img id="prizeImg" src="'+i.icon+'" style="width:2rem;height:2rem;"/></p>':"").replace("${logStatus}",i.exchangeState?'<p class="medium-font" style="color:#fe4429;">奖品已兑换</p><p class="small-font" style="color:#fe4429;">('+i.exchangetime+")</p>":'<p class="medium-font" style="color:#fe4429;">出示二维码兑奖</p>').replace("${formContent}",s.newAttribute.offlineTextList.map(function(e,n){return'<p><label class="medium-font">'+e.title+'：</label><span class="medium-font">'+e.value+"</span></p>"}).join("")).replace("${focus}",n).replace("${qrcode}",'<img src="'+e[1]+'" style="width:2.933rem;height:2.933rem;vertical-align: middle;"/>');layer.open({type:0,anim:!1,content:t,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(e){var n=$(e).find("#goBack"),t=$(e).find("#focus"),i="pc"==o.getPlatform()?"click":"touchend";o.bindAnim($(".layer-winning"),"bounceInDown"),t.on(i,function(){o.openQrcode(a)}),n.on(i,function(){layer.closeAll(),o.postMessage(a,"game_reset")})}})}).catch(function(){o.confim({text:"生成兑奖二维码失败，重新生成？",btnArr:["重新生成","返回首页"],cb1:function(){e()},cb2:function(){layer.closeAll(),o.postMessage(a,"game_reset")}})})}()},openOnlineInfo:function(a,i){var o=this,t=Utils.pluginConfig[a].theme.theme||"default";new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(o.getTemplate(e,i.icon?"online-Info_hasprizeImg":"online-Info"))})}).then(function(e){var n=Utils.pluginConfig[a].controlData.qrcode.url?'<div class="winning-btn-wrap" style="margin-top:0rem;"><span id="goBack" class="winning-btn medium-font" style="margin-right: 0.5rem;">返回首页</span><span id="focus" class="winning-btn medium-font">关注我们</span></div>':'<div class="winning-btn-wrap" style="margin-top:0rem;"><span id="goBack" class="winning-btn medium-font">返回首页</span></div>',t=e.replace("${optionName}",i.optionName).replace("${prize}",i.prizeName).replace("${prizeImg}",i.icon?'<p style="height:2rem;"><img id="prizeImg" src="'+i.icon+'" style="width:2rem;height:2rem;"/></p>':"").replace("${logStatus}",1==i.isProvide?'<p class="mini-font">奖品已寄出 '+i.provideTime+"</p>":'<p class="mini-font">奖品未寄出</p>').replace("${focus}",n).replace("${formContent}",i.formArr.map(function(e,n){return'<p><label class="mediau-font">'+e.name+'：</label><span class="medium-font">'+e.content+"</span></p>"}).join(""));layer.open({type:0,anim:!1,content:t,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(e){var n=$(e).find("#goBack"),t=$(e).find("#focus"),i="pc"==o.getPlatform()?"click":"touchend";o.bindAnim($(".layer-winning"),"bounceInDown"),t.on(i,function(){o.openQrcode(a)}),n.on(i,function(){layer.closeAll(),o.postMessage(a,"game_reset")})}})}).catch(function(){})},openNotWinning:function(a,e){var o=this,t=Utils.pluginConfig[a].theme.theme||"default";new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(o.getTemplate(e,"not-winning"))})}).then(function(e){var n=Utils.pluginConfig[a].controlData.qrcode.url?'<span id="goBack" class="winning-btn medium-font" style="margin-right: 0.5rem;">再来一次</span><span id="focus" class="winning-btn medium-font">关注我们</span>':'<span id="goBack" class="winning-btn medium-font">再来一次</span>',t=e.replace("${focus}",n);layer.open({type:0,anim:!1,content:t,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(e){var n=$(e).find("#goBack"),t=$(e).find("#focus"),i="pc"==o.getPlatform()?"click":"touchend";o.bindAnim($(".layer-winning"),"bounceInDown"),n.on(i,function(){layer.closeAll(),o.postMessage(a,"game_restart")}),t.on(i,function(){o.openQrcode(a)})}})})},openNoWinningInfo:function(a,i){var o=this,t=Utils.pluginConfig[a].theme.theme||"default";new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/tpl.html",function(e){n(o.getTemplate(e,"no-winning-info"))})}).then(function(e){var n=Utils.pluginConfig[a].controlData.qrcode.url?'<span id="goBack" class="winning-btn medium-font" style="margin-right: 0.5rem;">返回首页</span><span id="focus" class="winning-btn medium-font">关注我们</span>':'<span id="goBack" class="winning-btn medium-font">返回首页</span>',t=e.replace("${focus}",n).replace("${face}",i.face);layer.open({type:0,anim:!1,content:t,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(e){var n=$(e).find("#goBack"),t=$(e).find("#focus"),i="pc"==o.getPlatform()?"click":"touchend";o.bindAnim($(".layer-winning"),"bounceInDown"),n.on(i,function(){layer.closeAll(),o.postMessage(a,"game_reset")}),t.on(i,function(){o.openQrcode(a)})}})})},openMyPrize:function(i){var n=this;n.loading("查询我的奖品信息，请稍后"),new Promise(function(n,t){Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"activity/plugin/drawprize/log?relationId="+lanh.kid+"&controlId="+i+"&session_id="+e.session_id,type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},success:function(e){n(e.data)},error:function(e){400==e.status?Utils.simpleMsg(JSON.parse(e.responseText).message||"获取数据失败!"):Utils.simpleMsg("获取数据失败!"),t()}})})}).then(function(e){if(layer.close(n.loadingBox),e.log&&1==e.log.state)if(e.log.userCashType)switch(e.log.userCashType){case 1:n.openOnlineInfo(i,{prizeName:e.log.prizeName,icon:e.log.icon,optionName:e.log.optionName,formArr:e.content,exchangeState:e.log.exchangeState,exchangetime:n.dateString(e.log.exchangetime),isProvide:e.log.isProvide,provideTime:e.log.provideTime?n.dateString(e.log.provideTime):""});break;case 2:n.offlineCashPrize(i,{prizeName:e.log.prizeName,icon:e.log.icon,optionName:e.log.optionName,exchangeState:e.log.exchangeState,exchangetime:n.dateString(e.log.exchangetime),id:e.log.id,isProvide:e.log.isProvide,provideTime:e.log.provideTime?n.dateString(e.log.provideTime):""})}else n.openSwitchCashPrize(i,{prizeName:e.log.prizeName,icon:e.log.icon,optionName:e.log.optionName,exchangeState:e.log.exchangeState,exchangetime:n.dateString(e.log.exchangetime),id:e.log.id});else n.openNoWinningInfo(i,{face:e.face||"/public/images/h5/default-face.png"})}).catch(function(){layer.close(n.loadingBox)})},smashGoldEgg:function(i){var a=this,t=Utils.pluginConfig[i].theme.theme||"default";Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/smash-gold-eggs.html",function(e){n(a.getTemplate(e,"smashGoldEgg"))})})]).then(function(e){layer.open({type:0,anim:!1,content:e[0],shadeClose:!1,scrollbar:!1,className:"layer-smashGoldEggs",shade:"background-color: rgba(0,0,0,.6)",success:function(n){var e="pc"==a.getPlatform()?"click":"touchend",t=!1;$(n).find(".closeBtn").on(e,function(e){layer.closeAll()}),$(n).find(".hammer").on(e,function(e){if(t)return!1;t=!0,a.goDrawPrize(i,function(e){$(n).find(".smashGoldEgg-bg").addClass("smashing"),setTimeout(function(){$(n).find(".smashGoldEgg-bg").removeClass("smashing"),$(n).find(".smashGoldEgg-bg").addClass("smashed"),setTimeout(function(){$(n).find(".smashGoldEgg-bg").addClass("finished"),t=!1,a.emit("draw_end",{controlId:i,data:e})},800)},800)})})}})})},dismantRedEnvekopes:function(i){var a=this,t=Utils.pluginConfig[i].theme.theme||"default";Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/dismant-red-envelopes.html",function(e){n(a.getTemplate(e,"dismantRedEnvelopes"))})})]).then(function(e){layer.open({type:0,anim:!1,content:e[0],className:"layer-dismantRedEnvelopes",shadeClose:!1,scrollbar:!1,shade:"background-color: rgba(0,0,0,.6)",success:function(e){var n="pc"==a.getPlatform()?"click":"touchend",t=!1;$(e).find(".redEnvelopes").on(n,function(e){var n=this;if(t)return!1;t=!0,a.goDrawPrize(i,function(e){$(n).attr("src","/public/images/dismant-red-envelopes/redEnvelopes2.png"),a._setTimeout&&clearTimeout(a._setTimeout),a._setTimeout=setTimeout(function(){t=!1,a.emit("draw_end",{controlId:i,data:e})},1e3)})}),$(e).find(".closeBtn").on(n,function(e){layer.closeAll()})}})})},drawAnimation:function(o,e){var s=this,t=Utils.pluginConfig[o].theme.theme||"default";new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/draw.html",function(e){n(s.getTemplate(e,"draw"))})}).then(function(e){layer.open({type:0,anim:!1,content:e,className:"layer-draw",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(e){var n=$(e).find("#start"),t=$(e).find(".closeBtn"),i="pc"==s.getPlatform()?"click":"touchend",a=!1;s.bindAnim($(".draw"),"bounceInDown"),n.on(i,function(){if(n.parent().addClass("start"),a)return!1;a=!0,s.goDrawPrize(o,function(e){s._setTimeout&&clearTimeout(s._setTimeout),s._setTimeout=setTimeout(function(){a=!1,s.emit("draw_end",{controlId:o,data:e})},1e3)})}),t.on(i,function(){s.bindAnim($(".draw"),"bounceOutUp",function(){layer.closeAll()})})}})})},openGameRank:function(i,a){var o=this,t=Utils.pluginConfig[i].theme.theme||"default",s="",r="";o.loading("获取游戏排行榜数据，请稍后"),Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+t+"/game-ranks.html",function(e){s=o.getTemplate(e,"rank1"),r=o.getTemplate(e,"rank2"),n(o.getTemplate(e,"gameRankings"))})}),new Promise(function(n,t){if(Utils.getQueryString("preview")){var e={userFace:"/public/images/h5/default-face.png",rank:o.previewScore?1:-1,list:o.previewScore?[{userFace:"/public/images/h5/default-face.png",userNickname:"商家预览",score:o.previewScore}]:[]};n(e)}else Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"activity/plugin/score/list?session_id="+e.session_id,type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:{relationId:lanh.kid,controlId:i,pageIndex:1,pageSize:100},success:function(e){n(e.data)},error:function(e){400==e.status?Utils.simpleMsg(JSON.parse(e.responseText).message||"获取数据失败!"):Utils.simpleMsg("获取数据失败!"),t()}})})})]).then(function(e){var t="";layer.close(o.loadingBox),0<e[1].list.length?e[1].list.forEach(function(e,n){t+=n<3?s.replace("{imgRank}",0==n?"first":1==n?"second":"third").replace("{faceImg}",e.userFace).replace("{nickName}",e.userNickname).replace("{score}",e.score):r.replace("{rank}",n+1).replace("{faceImg}",e.userFace).replace("{nickName}",e.userNickname).replace("{score}",e.score)}):t="<tr><td colspan='4'>暂无排名</td></tr>";var n=e[0].replace("{myselfRank}",-1!=e[1].rank?"当前排名: 第"+e[1].rank+"名":"当前排名: 暂无").replace("{myselfFace}",e[1].userFace).replace("{rankContent}",t);layer.open({type:0,anim:!1,content:n,shadeClose:!1,scrollbar:!1,className:"layer-gameRankings",shade:"background-color: rgba(0,0,0,.6)",success:function(e){var n="pc"==o.getPlatform()?"click":"touchend";$(e).find(".closeBtn").on(n,function(e){a?(o.bindAnim($(".layer-gameRankings"),"fadeOut"),a()):layer.closeAll()})}})}).catch(function(){layer.close(o.loadingBox)})},goDrawPrize:function(t,i){var a=this;this.loading("正在抽奖，请稍后"),Utils.getToken(function(n){Utils.isWxMini(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"activity/plugin/drawprize?session_id="+n.session_id,type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:n.session_id},data:JSON.stringify({relationId:lanh.kid,controlId:t,shareId:Utils.getQueryString("rootUserId")||Utils.getQueryString("userId"),isWeapp:e?"weapp":a.isWX()?"wx":"pc"}),success:function(e){layer.close(a.loadingBox),a.getPlatform,i&&i(e.data)},error:function(e){400==e.status&&Utils.simpleMsg(JSON.parse(e.responseText).message),layer.close(a.loadingBox)}})})})},openchanllengeResult:function(r,c){var l=r.controlId,i=r.data.gameScore,t="",a="",n="",d=this;a=Utils.pluginConfig[l].theme.theme||"default",t=i>=Utils.pluginConfig[l].score?"challenge-suc":"challenge-fail",d.loading("上传游戏积分中，请稍后"),function e(){new Promise(function(n,t){"pc"==d.getPlatform()?n(!0):Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"activity/plugin/score?session_id="+e.session_id,type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:JSON.stringify({relationId:lanh.kid,controlId:r.controlId,score:i}),success:function(e){n(!0)},error:function(e){t()},complete:function(e,n){}})})}).then(function(e){layer.close(d.loadingBox),d.loading("获取最佳排名数据，请稍后"),function e(){Promise.all([new Promise(function(n,e){$.get("/public/layer/theme/"+a+"/tpl.html",function(e){n(d.getTemplate(e,t))})}),new Promise(function(n,t){Utils.getQueryString("preview")?(d.previewScore=i,n({rankPer:100,bestScore:i,bestRank:"1",intervalDrawTime:Utils.pluginConfig[l].intervalDrawTime,isWin:!1})):Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"activity/plugin/user/rank?relationId="+lanh.kid+"&controlId="+l+"&session_id="+e.session_id,type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},success:function(e){n(e.data)},error:function(e){400==e.status?Utils.simpleMsg(JSON.parse(e.responseText).message||"获取数据失败!"):Utils.simpleMsg("获取数据失败!"),t()}})})})]).then(function(e){switch(layer.close(d.loadingBox),t){case"challenge-suc":n=e[0].replace("${score}",i).replace("${bitNum}",e[1].rankPer).replace("${bestScores}",e[1].bestScore).replace("${bestRank}",e[1].bestRank).replace("${face}",e[1].face||"/public/images/h5/default-face.png").replace("${leftNum}",e[1].isWin?"":'<p class="small-font" style="top:9.7rem;color:#0ca3b0;">今日还有'+e[1].intervalDrawTime+"次抽奖机会</p>").replace("${bigBtn}",e[1].isWin?'<span id="my-prize" class="button big-font">查看奖品</span>':0<e[1].intervalDrawTime?'<span id="goDraw" class="button big-font">赶紧去抽奖</span>':'<span class="button big-font disabeld">赶紧去抽奖</span>');break;case"challenge-fail":n=e[0].replace("${score}",i).replace("${needScore}",Utils.pluginConfig[l].score).replace("${bestScores}",e[1].bestScore).replace("${bestRank}",e[1].bestRank).replace("${face}",e[1].face||"/public/images/h5/default-face.png")}layer.open({type:0,anim:!1,content:n,className:"layer-draw",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(e){var n=$(e).find("#rank"),t=$(e).find("#restart"),i=$(e).find("#goBack"),a=$(e).find("#my-prize"),o=$(e).find("#goDraw"),s="pc"==d.getPlatform()?"click":"touchend";c||d.bindAnim($(".challenge-suc"),"bounceInDown"),t.on(s,function(){layer.closeAll(),d.postMessage(l,"game_restart")}),i.on(s,function(){layer.closeAll(),d.postMessage(l,"game_reset")}),a.on(s,function(){d.openMyPrize(l)}),o.on(s,function(){switch(layer.closeAll(),Utils.pluginConfig[l].controlData.drawStyle){case"redEnvelope":d.dismantRedEnvekopes(l);break;case"golden":d.smashGoldEgg(l);break;case"draw":d.drawAnimation(l)}}),n.on(s,function(){d.openGameRank(l,function(){d.openchanllengeResult(r,!0)})})}})}).catch(function(){layer.close(d.loadingBox),d.confim({text:"获取最佳排名数据失败，重新获取？",btnArr:["重新获取","返回首页"],cb1:function(){layer.close(d.confimBox),e()},cb2:function(){layer.closeAll(),d.postMessage(l,"game_reset")}})})}()}).catch(function(){layer.close(d.loadingBox),d.confim({text:"上传积分失败，重新上传？",btnArr:["重新上传","返回首页"],cb1:function(){layer.close(d.confimBox),e()},cb2:function(){layer.closeAll(),d.postMessage(l,"game_reset")}})})}()},getProvinceList:function(n){var t="&secret_key="+this.secret_key;Utils.getToken(function(e){$.ajax({url:lanh.msHost.replace(/:\d+/g,"")+"api/identify_service/v1/divisions/provinces?session_id="+e.session_id+t,type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:{},success:function(e){0==e.status?n&&n(e.data):Utils.simpleMsg("获取省份数据列表失败")},error:function(e){Utils.simpleMsg("获取省份数据列表失败!")}})})},getCityList:function(e,n){var t="&secret_key="+this.secret_key+"&province_code="+e;Utils.getToken(function(e){$.ajax({url:lanh.msHost.replace(/:\d+/g,"")+"api/identify_service/v1/divisions/cities?session_id="+e.session_id+t,type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:{},success:function(e){0==e.status?n&&n(e.data):Utils.simpleMsg("获取城市数据列表失败")},error:function(e){Utils.simpleMsg("获取城市数据列表失败!")}})})},getAreasList:function(e,n){var t="&secret_key="+this.secret_key+"&city_code="+e;Utils.getToken(function(e){$.ajax({url:lanh.msHost.replace(/:\d+/g,"")+"api/identify_service/v1/divisions/areas?session_id="+e.session_id+t,type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:{},success:function(e){0==e.status?n&&n(e.data):Utils.simpleMsg("获取区域数据列表失败")},error:function(e){Utils.simpleMsg("获取区域数据列表失败!")}})})},fileUpload:function(n,t){var i="&secret_key="+this.secret_key;Utils.getToken(function(e){$.ajax({url:lanh.msHost.replace(/:\d+/g,"")+"api/assets_service/v1/assets/upload?session_id="+e.session_id+i,type:"POST",contentType:!1,processData:!1,dataType:"json",headers:{session_id:e.session_id},data:n,success:function(e){0==e.status?t&&t(e.data[0].file):Utils.simpleMsg("文件上传失败")},error:function(e){Utils.simpleMsg("文件上传失败!")}})})},buryingPoint:function(t){var i=this;Utils.isWxMini(function(e){var n=$.extend({forwardKey:i.myforwardKey,relationId:lanh.kid,rootUserId:Utils.myrootUserId||Utils.getQueryString("rootUserId")||Utils.getQueryString("userId"),clientType:e?"weapp":Utils.isWX()?"wx":"pc"},t);Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"relationship/behavior/gather?session_id="+e.session_id,type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:JSON.stringify(n),success:function(e){},error:function(e){}})})})},openRedpack:function(e){var o=this,t=e.redPacketInfo;new Promise(function(n,e){$.get("/public/layer/theme/default/redpack.html",function(e){n(o.getTemplate(e,"redpack-open"))})}).then(function(e){var n=e.replace("${bussinessHead}",t.b_logo).replace("${bussinessName}",t.b_name).replace("${title}",t.red_packet_title).replace("${content}",t.red_packet_content);layer.open({type:0,anim:!1,content:n,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(e){var n=$(e).find("#open"),t=$(e).find("#close"),i="pc"==o.getPlatform()?"click":"touchend",a=!1;o.bindAnim($(".redpack-wrap"),"bounceInDown"),n.on(i,function(){if(a)return!1;a=!0,Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"award/redpacket/open?session_id="+e.session_id,type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:JSON.stringify({main_id:Utils.awardRedPacket,rootUserId:Utils.getQueryString("rootUserId")||Utils.getQueryString("userId")}),success:function(e){0==e.status?Utils.emit("getRedpackInfo",!0):Utils.simpleMsg("红包打开失败，status:"+e.status),a=!1},error:function(e){Utils.simpleMsg("红包打开失败"),a=!1}})})}),t.on(i,function(e){e.stopPropagation(),e.preventDefault(),layer.closeAll(),Utils.redpackOpening=!1})}})}).catch(function(){})},forwardRedpack:function(l){var d=this,p=l.redPacketInfo;new Promise(function(n,e){$.get("/public/layer/theme/default/redpack.html",function(e){n(d.getTemplate(e,"redpack-forward"))})}).then(function(e){p.target_visitor<l.relation.length&&(l.relation=l.relation.slice(0,p.target_visitor));var n,t=l.relation.length,i=[],a=[];if(p.target_visitor>l.relation.length&&l.relation.length<8)for(var o=8<p.target_visitor?8:p.target_visitor,s=0;s<o-l.relation.length;s+=1)i.push({wx_face:"/public/images/redpack/head_replace.png"});n=(58*(a=l.relation.concat(i)).length+14+(8<p.target_visitor?27:0))/75;var r=a.map(function(e,n){return'<img class="headimg" src="'+e.wx_face+'" style="z-index: '+(10-n)+";left:"+.773333*n+'rem;">'});8<p.target_visitor&&r.push('<span style="position: absolute; left: 6.5rem;top: 0.1rem; color: #fff;">...</span>');var c=e.replace("${original_money}",l.money).replace("${target_visitor}",p.target_visitor).replace("${reach_lenth}",t).replace("${headImg_width}",n+"rem").replace("${cuntTime}",p.receive_num==p.red_packet_num?"红包已派完":3==l.activeState?"活动已结束":"").replace("${headImgArr}",r.join(""));layer.open({type:0,anim:!1,content:c,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(e){var n=$(e).find("#close"),o=$(e).find("#cuntTime"),t=null,s=l.remain_time,i="pc"==d.getPlatform()?"click":"touchend";function r(e){return e<10?"0"+e:e}function a(e){s=e;var n=parseInt(s/1e3/60/60/24,10),t=parseInt(s/1e3/60/60%24,10),i=parseInt(s/1e3/60%60,10),a=parseInt(s/1e3%60,10);n=r(n),t=r(t),i=r(i),a=r(a),o.text(n+"天"+t+"小时"+i+"分"+a+"秒")}d.bindAnim($(".redpack-wrap"),"bounceInDown"),p.receive_num!=p.red_packet_num&&3!=l.activeState&&(a(s),t=setInterval(function(){a(s-1e3)},1e3)),n.on(i,function(e){e.stopPropagation(),e.preventDefault(),layer.closeAll(),t&&clearInterval(t),Utils.redpackOpening=!1})}})}).catch(function(){})},reachRedpack:function(a){var o=this,s=a.redPacketInfo;Utils.isWxMini(function(t){new Promise(function(n,e){$.get("/public/layer/theme/default/redpack.html",function(e){n(o.getTemplate(e,t?"redpack-reach":"redpack-reach-wx"))})}).then(function(e){s.target_visitor<a.relation.length&&(a.relation=a.relation.slice(0,s.target_visitor));var n=(58*a.relation.length+14+(8<a.relation.length?27:0))/75,t=a.relation.map(function(e,n){return'<img class="headimg" src="'+e.wx_face+'" style="z-index: '+(10-n)+";left:"+.773333*n+'rem;">'});8<t.length&&t.push('<span style="position: absolute; left: 6.5rem;top: 0.1rem; color: #fff;">...</span>');var i=e.replace("${red_packet_premoney}",a.money).replace("${target_visitor}",s.target_visitor).replace("${reach_lenth}",a.relation.length).replace("${headImg_width}",n+"rem").replace("${is_finish}",3==a.activeState?'<p style="top: 7.32rem;font-size: 0.373rem;">活动已结束</p>':"").replace("${headImgArr}",t.join(""));layer.open({type:0,anim:!1,content:i,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!1,scrollbar:!1,success:function(e){var n=$(e).find("#close"),t=$(e).find("#gotoMini"),i="pc"==o.getPlatform()?"click":"touchend";o.bindAnim($(".redpack-wrap"),"bounceInDown"),n.on(i,function(e){e.stopPropagation(),e.preventDefault(),layer.closeAll(),Utils.redpackOpening=!1}),t.on(i,function(e){layer.closeAll(),e.stopPropagation(),e.preventDefault(),Utils.redpackOpening=!1,wx.miniProgram.reLaunch({url:"/pages/user/user"})})}})}).catch(function(){})})}},Utils.getQueryString("userId")||(Utils.layerIndex=layer.open({type:2}))}(window||this),"pc"!=Utils.getPlatform()){var _layer=$(".layui-m-layercont");window.addEventListener("focusin",function(e){var n=(e||window.evt).target;"form_0"!=$(n).attr("id")&&_layer.css("margin-top","-6rem")}),window.addEventListener("focusout",function(e){var n=(e||window.evt).target;"form_0"!=$(n).attr("id")&&_layer.css("margin-top","0")})}window.onload=function(e){Utils.accessStartTime=(new Date).getTime()},Utils.on("reportTime",function(){setInterval(function(){var e=((new Date).getTime()-Utils.accessStartTime)/1e3;Utils.buryingPoint({indexType:"user_report_time",timeLength:e,timeStamp:Utils.accessStartTime})},5e3)}),window.addEventListener("message",function(e){var n=e.data;return n&&"string"==typeof e.data&&JSON.parse(n),"flip"===n.type?Utils.emit("flip",n.pageIndex):Utils.emit(n.type,n)},!1),Utils.on("game_init",function(e,n){console.log(t);var t=n.data||{},i=n.contentWindow;t.type="game_init",1<$(".swiper-slide").length&&$("#flip-arrow").hide(),Utils.isWxMini(function(e){t.shareId=Utils.getQueryString("rootUserId")||Utils.getQueryString("userId"),t.isWeapp=e?"weapp":Utils.isWX()?"wx":"pc",i&&i.postMessage(t,"*")})}),Utils.on("draw_prize",function(e,n){Utils.openchanllengeResult(n)}),Utils.on("draw_end",function(e,n){switch(n.data.code){case 1:case 4:case 8:Utils.openNotWinning(n.controlId);break;case 5:Utils.simpleMsg("您今天的抽奖次数已用完，下次好运。");break;case 6:Utils.simpleMsg("您已经领取过奖品，点击我的奖品查看。");break;case 10:Utils.simpleMsg("活动未开始或已结束，请注意查看说明。");break;case 200:Utils.buryingPoint({indexType:"user_click",timeStamp:(new Date).getTime(),extType:"award"}),Utils.openSwitchCashPrize(n.controlId,{prizeName:n.data.prizeName,optionName:n.data.optionName,icon:n.data.icon,id:n.data.id||""});break;default:Utils.simpleMsg("服务端发生异常，小宝正火速解决。")}}),Utils.on("my_prize",function(e,n){Utils.openMyPrize(n.controlId)}),Utils.on("game_info",function(e,n){Utils.openActivityReadme(n.controlId)}),Utils.on("game_rank",function(e,n){Utils.openGameRank(n.controlId)}),Utils.on("game_quit",function(e,n){1<$(".swiper-slide").length&&$("#flip-arrow").show()}),$(function(){return Utils.checkCssAnimation()?(Utils.isWxMini(function(e){var a=location.href,o="pc"==Utils.getPlatform()?"click":"touchend";new Promise(function(i,t){Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"manuscript/detail?id="+lanh.kid+"&session_id="+e.session_id,method:"get",dataType:"json",headers:{session_id:e.session_id},success:function(e,n,t){i(e.data)},error:function(e,n){t("获取活动详情失败：err"+JSON.stringify(e))}})})}).then(function(t){if(Utils.h5Url=t.url,Utils.awardRedPacket=t.awardRedPacket,e)t.awardRedPacket?Utils.emit("getRedpackInfo"):Utils.emit("initFastNav"),Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"relationship/query/forwardKey?session_id="+e.session_id,type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:JSON.stringify({clientType:"wx",rootUserId:Utils.getQueryString("rootUserId")||Utils.getQueryString("userId"),forwardKey:Utils.getQueryString("forwardKey")||"",relationId:lanh.kid,sourceType:0}),success:function(e){0==e.status&&(Utils.myforwardKey=e.data.forwardKey,Utils.myrootUserId=e.data.rootUserId,Utils.emit("initAppointment"))},error:function(e){Utils.simpleMsg(e.message)}})});else{if(sessionStorage.setItem("session_id",t.session_id),sessionStorage.setItem("acitivityName",t.name),Utils.goodsCount=t.goodsNumber,3!=t.type||Utils.getQueryString("preview")||2==t.manuscriptType)return!1;Utils.isWX()&&Utils.getQueryString("userId")?new Promise(function(n,t){Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"relationship/query/forwardKey?session_id="+e.session_id,type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:JSON.stringify({clientType:"wx",rootUserId:Utils.getQueryString("rootUserId")||Utils.getQueryString("userId"),forwardKey:Utils.getQueryString("forwardKey")||"",relationId:lanh.kid,sourceType:0}),success:function(e){0==e.status&&(Utils.myforwardKey=e.data.forwardKey,Utils.myrootUserId=e.data.rootUserId,n(e.data))},error:function(e){Utils.simpleMsg(e.message),t()}})})}).then(function(e){Utils.buryingPoint({indexType:"user_browse",timeStamp:Utils.accessStartTime}),Utils.emit("initAppointment"),Utils.getToken(function(e){$.ajax({url:lanh.msHost.replace(/:\d+/g,"")+"api/identify_service/v1/openplatform/get_js_config?session_id="+e.session_id+"&secret_key="+Utils.secret_key+"&url="+encodeURIComponent(a),type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:{},success:function(e){if(0==e.status){wx.config({debug:!1,appId:e.data.appId,timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,signature:e.data.signature,jsApiList:["onMenuShareAppMessage","onMenuShareTimeline"]});var n=t.url+"?rootUserId="+(Utils.myrootUserId||Utils.getQueryString("rootUserId")||Utils.getQueryString("userId"))+"&forwardKey="+Utils.myforwardKey;n=3==t.manuscriptType?window.location.href.split("?")[0]+"?id="+lanh.kid+"&rootUserId="+(Utils.myrootUserId||Utils.getQueryString("rootUserId")||Utils.getQueryString("userId"))+"&forwardKey="+Utils.myforwardKey:n,wx.ready(function(){wx.onMenuShareAppMessage({title:t.name||"未命名稿件",desc:t.description||"",link:n,imgUrl:t.cover+"@c_1,w_320,h_320",success:function(){Utils.buryingPoint({indexType:"user_forward",timeStamp:(new Date).getTime()})},fail:function(e){}}),wx.onMenuShareTimeline({title:t.name||"未命名稿件",desc:t.description||"",link:n,imgUrl:t.cover+"@c_1,w_320,h_320",success:function(){Utils.buryingPoint({indexType:"user_forward",timeStamp:(new Date).getTime()})},fail:function(e){}})}),wx.error(function(e){console.log("微信验证失败。"),console.error(e)}),t.awardRedPacket?Utils.emit("getRedpackInfo"):Utils.emit("initFastNav")}},error:function(e){self.simpleMsg("获取jsconfig失败，status:"+e.status)}})}),Utils.emit("reportTime")}).catch(function(){}):Utils.getToken(function(e){new Promise(function(n,t){$.ajax({url:lanh.msHost.replace(/:\d+/g,"")+"api/identify_service/v1/openauth/wx_authorize?secret_key="+Utils.secret_key,type:"POST",contentType:"application/json",dataType:"json",data:{},success:function(e){n(e.data)},error:function(e){t()}})}).then(function(e){var n=(-1!=location.href.indexOf("tuixb.cn")?"https:":"http:")+lanh.msHost;function t(){window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+e.appid+"&redirect_uri="+encodeURIComponent(n.replace(/:\d+/g,"")+"/api/identify_service/v1/openauth/wx_callback?secret_key="+Utils.secret_key+"&returnUrl="+encodeURIComponent(a))+"&response_type=code&scope=snsapi_userinfo&state="+e.state+"#wechat_redirect"}var i=$('                            <div style="position:absolute;top:0;left:0;width:100%;height:100vh;line-height:100vh;text-align:center;background-color:rgba(0,0,0,.5);z-index:2;">                                <button id="btn" style="width:4rem;height:1.5rem;border-radius:1.5rem;line-height:1.5rem;border:none;outline:none;color:#fff;background-color:#00bad0;font-size:0.5rem;">授权登陆</button>                            </div>');t(),setTimeout(function(){$("body").append(i)},3e3),i.find("#btn").on(o,function(){t()})}).catch(function(){Utils.simpleMsg("获取appid失败，没法授权")})})}}).catch(function(e){Utils.simpleMsg(e)})}),Utils.on("getRedpackInfo",function(e,n){new Promise(function(i,t){Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"award/redpacket/info?session_id="+e.session_id,type:"POST",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:JSON.stringify({main_id:Utils.awardRedPacket}),success:function(e,n,t){i(e.data)},error:function(e,n){t("获取红包详情失败：err"+JSON.stringify(e))}})})}).then(function(e){if(0==e.canOpen)return Utils.emit("initFastNav"),!1;0==e.open?Utils.openRedpack(e):n&&(0==e.issue_status||2==e.issue_status?Utils.forwardRedpack(e):Utils.reachRedpack(e)),Utils.emit("initFastNav","redpack")}).catch(function(e){Utils.simpleMsg("获取红包详情失败：err"+JSON.stringify(e))})}),Utils.on("initAppointment",function(){new Promise(function(n,t){Utils.getToken(function(e){$.ajax({url:lanh.apiHost.replace(/:\d+/g,"")+"activity/plugin/getAppointmentByRelationId?session_id="+e.session_id+"&relationId="+lanh.kid,type:"GET",contentType:"application/json",dataType:"json",headers:{session_id:e.session_id},data:{},success:function(e){n(e.data)},error:function(e){t("获取预约设置失败：err"+JSON.stringify(e))}})})}).then(function(s){s&&$.get("/public/layer/theme/default/appointment.html",function(e){var n=Utils.getTemplate(e,1<s.data.length?"appointment-btn-double":"appointment-btn-single");n=n.replace("${btn1Bg}",s.data[0].btnStyle.bg).replace("${btn1Color}",s.data[0].btnStyle.color).replace("${btn1Text}",s.data[0].button_name).replace("${btn2Bg}",s.data[1].btnStyle.bg).replace("${btn2Color}",s.data[1].btnStyle.color).replace("${btn2Text}",s.data[1].button_name);var t=$("<div #appoint-menu></div>");t.html(n),$("body").append(t);var i="pc"==Utils.getPlatform()?"click":"touchend",a=t.find("#appointBtn1"),o=t.find("#appointBtn2");Utils.isWxMini(function(e){var n=e?"weapp":Utils.isWX()?"wx":"pc",t=["rootUserId="+(Utils.myrootUserId||Utils.getQueryString("rootUserId")||Utils.getQueryString("userId")),"id="+lanh.kid,"clientType="+n,"forwardKey="+Utils.myforwardKey,"session_id="+(Utils.getQueryString("session_id")||sessionStorage.getItem("session_id")),"returnUrl="+encodeURIComponent(location.href)];a.on(i,function(e){e.stopPropagation(),t.push({index:0});var n=Utils.h5Url.replace("//","$").split("/")[0].replace("$","//")+"/appointment?"+t.join("&");window.location.href=n}),o.on(i,function(e){e.stopPropagation(),t.push({index:1});var n=Utils.h5Url.replace("//","$").split("/")[0].replace("$","//")+"/appointment?"+t.join("&");window.location.href=n})})})}).catch(function(e){Utils.simpleMsg(e)})}),function(){var n=!1;if($("#page-panel").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){function e(e,n){var t=$.extend(!0,{type:"pagination"},n);parent&&parent.postMessage(t,"*")}n||(n=!0,Utils.on("pageinit",e),Utils.on("pagechanged",e),Utils.ready(!0))}).show(),setTimeout(function(){$("#page-panel").addClass("animated fadeIn"),Utils.getQueryString("userId")||$("#layui-m-layer"+Utils.layerIndex).addClass("animated fadeOut")},100),"pc"!==Utils.getPlatform()||document.referrer){var e=Utils.getViewport();$("#page-panel").css({height:e.height,width:e.width})}else $("html").css({"background-color":"rgb(137, 150, 160)"});Utils.on("initFastNav",function(e,n){var a=n?["<div id='toRedpackLog'><img src='/public/images/fast-nav-redpack.png' /><div>红包</div></div>"]:[];Utils.isWxMini(function(t){var i;t&&a.push("<div id='jumpIndex'><img src='/public/images/fast-nav-index.png' /><div>首页</div></div>"),i=$("#fastNav"),new Promise(function(n,e){$.get("/public/layer/theme/default/fast-nav.html",function(e){n(Utils.getTemplate(e,"fast-nav"))})}).then(function(e){var n=e.replace("${fast-nav}",a.join("")).replace("${single-style}",0==a.length?"height: 1.33rem !important;padding: 0.24rem 0 !important;":"");i.html(n),i.on("click","#jumpIndex",function(e){e.stopPropagation(),wx.miniProgram.reLaunch({url:"/pages/overview/overview"})}),i.on("click","#toRedpackLog",function(e){if(Utils.redpackOpening)return!1;e.stopPropagation(),Utils.redpackOpening=!0,Utils.emit("getRedpackInfo",!0)}),i.on("click","#toShare",function(e){e.stopPropagation(),t?wx.miniProgram.navigateTo({url:"/pages/extension-task-share/extension-task-share?id="+Utils.getQueryString("id")+"&rootUserId="+(Utils.myrootUserId||Utils.getQueryString("rootUserId"))+"&forwardKey="+Utils.getQueryString("forwardKey")}):new Promise(function(n,e){$.get("/public/layer/theme/default/redpack.html",function(e){n(Utils.getTemplate(e,"share-layer"))})}).then(function(e){layer.open({type:0,anim:!1,content:e,className:"layer-winning",shade:"background-color: rgba(0,0,0,.6)",shadeClose:!0,scrollbar:!1})})})})})})}()):Utils.createScript("/public/dist/qrcode.min.js",function(){$("#page-qrcode").show(),new QRCode(document.getElementById("qrcode-panel"),{text:location.href,width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})})});