<!--pages/card-list/card-list.wxml-->
<view class='card-list'>
  <view class='search-wrap' wx:if="{{tpl == 'list' && type != '2'}}">
    <view class='text'>{{totalNum}}个{{!isList ? '待处理':''}}名片</view>
    <image class='icon' src="/images/icon-search.png" bindtap='searchCard'></image>
  </view>
  <view class='list'>
    <view style='padding-top:90rpx;' wx:if="{{tpl == 'list' && !isSelfCard}}">
      <view class='new-style'>
        <view class='item' wx:for="{{list}}" wx:key="id">
          <view class='info' bindtap='toCardDetail' data-id="{{item.id}}">
            <view class='pic'>
              <image class='face' src="{{!item.face?'/images/icon-default-photo.png':item.face}}"></image>
            </view>
            <view class='info-desc' style="border-bottom:{{(!pagination.dataMore && (index == list.length -1)) ? 'none' : '1rpx solid #bdbdbd'}}">
              <view class='text'>
                <view class='name'>{{item.name}}</view>
                <view>{{item.job||"暂无职位信息"}}</view>
                <view class='eslip' style='width: 360rpx;'>{{item.company||"暂无公司信息"}}</view>
                <view>
                  <image class='phone' src='/images/icon-phone.png'></image>{{item.phone || '暂无手机号'}}
                </view>
              </view>

              <view class="btn-group" wx:if="{{item.type == '2' && item.status == '1' && !!userInfo.phone}}">
                <image class='agree-icon' src='/images/icon-agree.png' catchtap='exchange' data-type="0" data-id="{{item.id}}" data-item="{{item}}"></image>
                <image class='agree-icon' src='/images/icon-refuse.png' catchtap='exchange' data-type="3" data-id="{{item.id}}" data-item="{{item}}"></image>
              </view>

              <view class="tag tag_agree" wx:if="{{item.status == 0 && item.type == 2}}">已同意</view>
              <view class="tag tag_refuse" wx:if="{{item.status == 3 && item.type == 2}}">已拒绝</view>
            </view>
          </view>
          
        </view>
      </view>
      <view class='weui-loadmore' hidden="{{pagination.pageIndex <= 1}}">
        <text class="weui-loading" wx:if="{{listStatus.isLoading}}"></text>
        <text class="weui-loadmore__tips">{{listStatus.loadingText}}</text>
      </view>
      <view wx:if="{{!isList && !userInfo.phone && !isSelfCard && !isExist}}" style='padding-bottom:20rpx;'>
        <view class="tip" style='margin:100rpx 0 10rpx;'>您还没有推小宝名片</view>
        <view class="tip" style='margin-bottom: 115rpx;'>开通后才可以交换名片</view>
        <button class="weui-flex__item text-center open-btn" plain='true' open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">
          立即开通
        </button> 
      </view>
    </view>
    <view wx:if="{{tpl == 'exchange' || isSelfCard}}">
      <view wx:if="{{!isSelfCard && !isExist && !!userInfo.phone}}" style='height:100vh;background-color:#fff;'>
        <view class='text-center' style='line-height:120rpx;'>{{detail.name}}邀请你交换名片</view>
        <view class='exchange-section'>
          <view class='item' style='top: 0rpx;left:30rpx;z-index:2;'>
            <view class='info'>
              <view class='pic'>
                <image class='face' src="{{!detail.face?'/images/icon-default-photo.png':detail.face}}"></image>
              </view>
              <view class='text'>
                <view class='name'>{{detail.name}}</view>
                <view>{{detail.job || "暂无职位信息"}}</view>
                <view class='eslip' style='width: 400rpx;'>{{detail.company || "暂无公司信息"}}</view>
                <view>
                  <image class='phone' src='/images/icon-phone.png'></image>{{detail.phone || ''}}
                </view>
              </view>
            </view>
          </view>
          <image class='icon' style='top: 128rpx;right:50rpx;z-index:2;' src='/images/exchange-arrow-left.png'></image>
          <view class='item' style='top: 320rpx;right:30rpx;z-index:1;'>
            <view class='info'>
              <view class='pic'>
                <image class='face' src="{{!userInfo.face?'/images/icon-default-photo.png':userInfo.face}}"></image>
              </view>
              <view class='text'>
                <view class='name'>{{userInfo.name}}</view>
                <view>{{userInfo.job || "暂无职位信息"}}</view>
                <view>{{userInfo.company || "暂无公司信息"}}</view>
                <view>
                  <image class='phone' src='/images/icon-phone.png'></image>{{userInfo.phone || ''}}
                </view>
              </view>
            </view>
          </view>
          <image class='icon' style='top: 500rpx;left:60rpx;z-index:1;' src='/images/exchange-arrow-right.png'></image>
        </view>
        <button class='agree' type='primary' bindtap='exchange' data-type="0" data-id="{{detail.id}}">同意交换名片</button>
      </view>
      <view class='{{!!userInfo.phone ? "exchange" : "" }}' wx:else>
        <view class='item' bindtap='toCardDetail' style='border-radius: 20rpx;' data-id="{{detail.id}}" data-isExist="{{isExist}}">
          <view class='info'>
            <view class='pic'>
              <image class='face' src="{{!detail.face?'/images/icon-default-photo.png':detail.face}}"></image>
            </view>
            <view class='text'>
              <view class='name'>{{detail.name}}</view>
              <view>{{detail.job || "暂无职位信息"}}</view>
              <view class='eslip' style='width: 400rpx;'>{{detail.company || "暂无公司信息"}}</view>
              <view>
                <image class='phone' src='/images/icon-phone.png'></image>{{detail.phone || '暂无手机号'}}
              </view>
            </view>
          </view>
        </view>
        <view style='padding-bottom:20rpx;' wx:if='{{!isSelfCard && !isExist}}'>
          <view class="tip" style='margin:100rpx 0 10rpx;'>您还没有推小宝名片</view>
          <view class="tip" style='margin-bottom: 115rpx;'>开通后才可以交换名片</view>
          <button class="weui-flex__item text-center open-btn" plain='true' open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">
            立即开通
          </button> 
        </view>
      </view>
    </view>
    
    <view style='text-align:center;' wx:if="{{list.length == 0 && tpl == 'list'}}">
      <image class='empty-img' src="https://resource.tuixb.cn/beta/00000000-0000-0000-0000-000000000000/KMA/miniapp/icon-empty.png"></image>
      <view style='color:#999;font-size:24rpx;'>您暂时还没有任何名片</view>
    </view>
  </view>
</view>
<view wx:if="{{!!isShowFastNav}}">
  <comp-fast-nav>
  </comp-fast-nav>
</view>