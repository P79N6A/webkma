<view>
  <view class="page">
    <view class="page__bd">
      <comp-page-box-tips type="{{pageStatus}}"></comp-page-box-tips>
      <block wx:if="{{!pageStatus}}">
        <view class="bd__navbar" wx:if="{{formList.length > 0}}">
          <comp-navbar bind:tabchange="navbarTabChange" tabs="{{[{key:'baseData',title:'活动数据'},{key:'formData',title:'表单数据'}]}}" activeTab="{{activeNavTab}}"></comp-navbar> 
        </view>
        <block wx:if="{{activeNavTab == 'baseData'}}">
          <view class="bd__section {{formList.length==0?'head__row':''}}">
            <view class="head__title">
              <image style="width: 28rpx; height: 28rpx; vertical-align:middle; margin-right:10rpx;" src="/images/icon-chart-line.png"></image>
              <text class="font-bd" style="vertical-align:middle;">我的推广数据</text>
            </view>
            <comp-activity-charts-overview tid="{{id}}" article-sign="{{articleid}}"></comp-activity-charts-overview>
          </view>
          <view class="bd__section">
            <comp-activity-charts-line tid="{{id}}"></comp-activity-charts-line>
          </view>
          <view class="bd__section">
            <view class="head__title">
              <image style="width: 28rpx; height: 28rpx; vertical-align:middle; margin-right:10rpx;" src="/images/icon-chart-all.png"></image>
              <text class="font-bd" style="vertical-align:middle;">活动总数据</text>
            </view>
            <view class="section_row">
              <view class="rank-box">
                <block wx:key="item.key" wx:for="{{dataList}}">
                  <view class="weui-flex wrap" style="flex-direction: column;-webkit-flex-direction: column;">
                    <view>
                      <text>总{{item.title}}</text>
                    </view>
                    <view>
                      <text class="item-count">{{item.total || 0}}</text>
                    </view>
                  </view>
                </block>
              </view>
            </view>
            <view class="section_row">
              <view class="weui-flex" style="justify-content: space-between; align-items:baseline; -webkit-justify-content: space-between; -webkit-align-items:baseline;">
                <view class="font-bd">平均停留时长</view>
                <view class="font-bd" wx:if="{{avgLifeTime}}">{{avgLifeTime}}</view>
                <view class="font-bd text-empty-color" wx:else>暂无</view>
              </view>
            </view>
            <view class="section_row">
              <view class="weui-flex" style="justify-content: space-between; align-items:baseline; -webkit-justify-content: space-between; -webkit-align-items:baseline;">
                <view class="font-bd">访问地区TOP5</view>
                <view class="font-bd" wx:if="{{areaTopList}}">{{areaTopList}}</view>
                <view class="font-bd text-empty-color" wx:else>暂无</view>
              </view>
            </view>
          </view>
        </block>
        <block wx:elif="{{activeNavTab == 'formData'}}">
          <view class="form-list">
            <comp-page-box-tips type="{{formPageStatus}}"></comp-page-box-tips>
            <block wx:for="{{formList}}" wx:key="controlId">
              <view class="form-list__item">
                <view id="{{item.controlId}}" class="weui-flex form-list__item-hd" bindtap="formToggle">
                  <view class="weui-flex__item font-bd">{{item.name}}</view>
                  <text class="font-tips" wx:if="{{item.todayTotal && !item._open}}">+{{item.todayTotal}}</text>
                  <image class="form-list__img" src="/images/{{item._open?'icon-downArrows':'icon-arrows'}}.png"></image>
                </view>
                <view class="form-list__item-bd {{item._open ? 'form-list__item-bd_show' : ''}}">
                  <view class="weui-flex form-content">
                    <view class="overview-item">
                      <view class="item-count">{{item.todayTotal?("+"+item.todayTotal):0}}</view>
                      <view class="font-tips">今日新增数据</view>
                    </view>
                    <view class="overview-item">
                      <view class="item-count">{{item.total}}</view>
                      <view class="font-tips">总数据</view>
                    </view>
                  </view>
                  <view class="form-table">
                    <view class="form-bd">
                      <view class="table-row font-bd row-header">
                        <view class="row-column">
                          <view class="column-sort">排序</view>
                        </view>
                        <view class="row-column">
                          <view class="column-date">提交时间</view>
                        </view>
                        <view class="row-column">
                          <view class="column-detail">详细信息</view>
                        </view>
                      </view>
                      <view class="shadow-border border-top"></view>
                      <scroll-view id="{{item.controlId}}" class="form-scroll-view" style="max-height: 50vh;" scroll-y bindscrolltoupper="formContentRefresh" bindscrolltolower="formContentMore">
                        <block wx:for="{{item.detail.list}}" wx:key="id" wx:for-item="row">
                          <view id="{{row.id}}" class="table-row font-bd" bindtap="formContentDetailOpen">
                            <view class="row-column">
                              <view class="column-sort">{{index+1}}</view>
                            </view>
                            <view class="row-column">
                              <view class="column-date">{{row.date}}</view>
                            </view>
                            <view class="row-column">
                              <view class="column-detail">
                                <text>查看详情</text>
                                <image class="form-list__img" style="margin-top:-3rpx;" src="/images/icon-arrows.png"></image>
                              </view>
                            </view>
                          </view>
                        </block>
                        <view class="tip-row font-tips">
                          <view wx:if="{{item.detail._isLoading}}">
                            <view class='weui-loadmore' style='margin:0 auto;'>
                              <text class="weui-loading"></text>
                            </view>
                          </view>
                          <text wx:if="{{!item.detail._isLoading && item.detail.total == 0}}">还没有数据哟</text>
                          <text wx:if="{{item.detail.total > 0 && item.detail.list.length == item.detail.total}}">没有更多了</text>
                          <text wx:if="{{!item.detail._isLoading && item.detail.list.length < item.detail.total}}">加载更多</text>
                        </view>
                      </scroll-view>
                    </view>
                  </view>
                </view>
              </view>
            </block>
          </view>
        </block>
      </block>
    </view>
  </view>
  <!-- Form Content Detail -->
  <view class="weui-flex form-content-detail {{formDetailShow?'detail-show':''}}" catchtouchmove="stopScroll">
    <view>
      <view class="content-bd">
        <view class="row-header page-h2">表单详情</view>
        <scroll-view scroll-y style="height:50vh;" catchtouchmove="stopScroll">
          <view class="row-form-data font-bd">
            <view class="data-row" wx:for="{{formDetailInfo}}" wx:key="*this">
              <view class="row-title">
                <view>{{item.name}}</view>
              </view>
              <view class="row-space">：</view>
              <view class="row-content">
                <block wx:if="{{item.type == 'text_image-radio-option' || item.type == 'text_image-checkbox-option' || item.type == 'radio_image' || item.type == 'checkbox_image'}}">
                  <view class="content-option" wx:for="{{item.content}}" wx:for-item="option" wx:key="*this">
                    <view class="option-box">
                      <view>
                        <image class="option-img" src="{{option.img}}" id="{{index}}" data-imgs="{{item.content}}" bindtap="previewImage"></image>
                      </view>
                      <view>{{option.text}}</view>
                    </view>
                  </view>
                </block>
                <block wx:elif="{{item.type == 'text_upload'}}">
                  <view class="content-option" wx:for="{{item.content}}" wx:for-item="option" wx:key="*this">
                    <view class="option-box">
                      <view>
                        <image class="option-img" src="{{option.img}}" id="{{index}}" data-imgs="{{item.content}}" bindtap="previewImage"></image>
                      </view>
                    </view>
                  </view>
                </block>
                <block wx:else>
                  {{item.content}}
                </block>
              </view>
            </view>
          </view>
        </scroll-view>
        <view class="row-footer" bindtap="formContentDetailClose">
          <text style="color:#24d0c6;">确定</text>
        </view>
      </view>
    </view>
  </view>
</view>